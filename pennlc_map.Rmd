---
title: "Untitled"
author: "Arris Moise"
date: "6/11/2021"
output: html_document
---

```{r}
# load libraries 
library(ggplot2)
library(leaflet)
library(sf)
library(plyr)
library(dplyr)
library(Hmisc)
library(SpatialEpi)

# covert pennLC$spatial.polygon from sp to sf
pennLC_sf <- st_as_sf(pennLC$spatial.polygon)

#add all of the cases together by county
pennLC_df <- pennLC$data %>%
  group_by(county) %>%
  summarise(cases = sum(cases))
  
# add quotes to each county 
county <- Hmisc::Cs(adams, allegheny,
armstrong,
beaver,
bedford,
berks,
blair,
bradford,
bucks,
butler,
cambria,
cameron,
carbon,
centre,
chester,
clarion,
clearfield,
clinton,
columbia,
crawford,
cumberland,
dauphin,
delaware,
elk,
erie,
fayette,
forest,
franklin,
fulton,
greene,
huntingdon,
indiana,
jefferson,
juniata,
lackawanna,
lancaster,
lawrence,
lebanon,
lehigh,
luzerne,
lycoming,
mckean,
mercer,
mifflin,
monroe,
montgomery,
montour,
northampton,
northumberland,
perry,
philadelphia,
pike,
potter,
schuylkill,
snyder,
somerset,
sullivan,
susquehanna,
tioga,
union,
venango,
warren,
washington,
wayne,
westmoreland,
wyoming,
york)

# add county to sf object manually
pennLC_sf$county <- county

# now that we have a common value we can join
pennLC_sf <- left_join(pennLC_sf, pennLC_df)

# reorder columns so that geometry is first
pennLC_sf <- pennLC_sf[c(3,2,1)]


# create leaflet map
bins <- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)
pal <- colorBin("YlOrRd", domain = pennLC_sf$cases, bins = bins)

m <- leaflet(pennLC_sf) %>% 
  addPolygons(
    fillColor = ~pal(pennLC_sf$cases),
    weight = 2,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    popup = pennLC_sf$county) 

m
```

